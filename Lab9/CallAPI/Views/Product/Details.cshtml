@{
    ViewData["Title"] = "Chi tiết sản phẩm";
}

<div class="container mt-4">
    <div class="card shadow" style="max-width: 600px; margin: auto; border-radius: 12px; overflow: hidden;">
        <div class="card-header bg-info text-white text-center">
            <h4 class="mb-0">THÔNG TIN CHI TIẾT</h4>
        </div>
        <div class="card-body text-center">
            <img id="dImg" src="" style="max-width: 100%; height: 300px; object-fit: contain; background: #f8f9fa;"
                 onerror="this.src='https://placehold.co/300x300?text=No+Image'" />

            <h2 id="dName" class="mt-4 font-weight-bold text-dark"></h2>
            <hr />
            <div class="row text-left px-4">
                <div class="col-6 text-muted">Giá bán:</div>
                <div class="col-6"><strong id="dPrice" class="text-danger"></strong></div>

                <div class="col-6 text-muted mt-2">Danh mục:</div>
                <div class="col-6 mt-2">
                    <span id="dCate" class="badge p-2 text-dark" style="background-color: #f0f0f0; border: 1px solid #ccc; min-width: 80px; display: inline-block;"></span>
                </div>
            </div>
        </div>
        <div class="card-footer d-flex justify-content-between">
            <a href="/Product" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left"></i> Quay lại
            </a>
            <a href="/Product/Edit/@ViewBag.Id" class="btn btn-warning">
                <i class="fas fa-edit"></i> Chỉnh sửa
            </a>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            const id = "@ViewBag.Id";
            const API_URL = "https://localhost:7198/api/products/" + id;

            $.get(API_URL, function(res) {
                console.log("Dữ liệu API trả về:", res); // Bạn nhấn F12 kiểm tra dòng này

                $("#dName").text(res.name || "Chưa có tên");
                $("#dPrice").text(res.price ? res.price.toLocaleString() + " VNĐ" : "Liên hệ");
                $("#dImg").attr("src", res.imageUrl || "");

                // KIỂM TRA: Thử lấy CategoryName trước, nếu không có mới lấy CategoryId
                // Lưu ý: Kiểm tra chính xác tên thuộc tính viết Hoa/Thường từ Console
                let cateDisplay = res.categoryName || res.categoryName || res.categoryId || res.categoryId || "Chưa phân loại";
                $("#dCate").text(cateDisplay);

            }).fail(function(xhr) {
                console.error("Lỗi API:", xhr);
                alert("Không thể tải thông tin sản phẩm. Vui lòng kiểm tra API!");
            });
        });
    </script>
}